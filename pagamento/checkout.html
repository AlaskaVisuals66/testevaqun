<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <script src="https://cdn.utmify.com.br/scripts/utms/latest.js" data-utmify-prevent-xcod-sck data-utmify-prevent-subids async defer></script>
    <script>
        window.pixelId = "6886c1a09f507dac93e6a001";
        var a = document.createElement("script");
        a.setAttribute("async", "");
        a.setAttribute("defer", "");
        a.setAttribute("src", "https://cdn.utmify.com.br/scripts/pixel/pixel.js");
        document.head.appendChild(a);
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="icon" href="images/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Biblioteca QRCode.js para gerar QR codes -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Inter', sans-serif;
    }

    body {
        padding: 20px;
        max-width: 600px;
        margin: 0 auto;
    }

    h1 {
        color: #4A2B0F;
        font-size: 24px;
        margin-bottom: 8px;
    }

    .id-number {
        color: #4A2B0F;
        font-size: 14px;
        margin-bottom: 30px;
    }

    .section-title {
        font-size: 16px;
        font-weight: 500;
        color: #333;
        margin-bottom: 15px;
    }

    .value-input {
        display: flex;
        position: relative;
        align-items: center;
        margin-bottom: 5px;
    }

    .currency-prefix {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        border-right: none;
        border-radius: 5px 0 0 5px;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        color: #333;
        font-weight: 500;
    }

    .value-field {
        flex: 1;
        border: 1px solid #ddd;
        border-radius: 0 5px 5px 0;
        padding: 10px 15px;
        font-size: 16px;
        outline: none;
    }

    .payment-methods {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
    }

    .payment-option {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px 15px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }

    .payment-option.pix {
        background-color: #22c55e;
        border-color: #22c55e;
        color: white;
    }

    .radio-button {
        width: 18px;
        height: 18px;
        border: 2px solid #ddd;
        border-radius: 50%;
        display: inline-block;
        position: relative;
    }

    .payment-option.pix .radio-button {
        border-color: white;
    }

    .payment-option.pix .radio-button::after {
        content: "";
        width: 10px;
        height: 10px;
        background-color: white;
        border-radius: 50%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .charity-options {
        border: 1px dashed #ccc;
        border-radius: 5px;
        display: flex;
        margin-bottom: 30px;
        overflow: hidden;
    }

    .charity-item {
        flex: 1;
        padding: 15px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: white;
        color: #333;
        border-right: 1px dashed #a1a1a1;
        height: 120px;
        justify-content: center;
    }

    .charity-item:last-child {
        border-right: none;
    }

    .charity-item.selected {
        background-color: rgba(34, 197, 94, 0.6);
        color: #ffffff;
        text-shadow: 1px 1px 2px rgba(85, 85, 85, 0.5);
    }

    .charity-item.selected:last-child {
        border-right: none;
    }

    .charity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 5px;
        overflow: hidden;
    }

    .charity-icon img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .heart-icon {
        background-color: #f0f9ff;
    }

    .society-icon {
        background-color: #f0fdf4;
    }

    .lucky-icon {
        background-color: #22c55e;
    }

    .charity-item.selected .charity-icon {
        background-color: white;
    }

    .charity-item.selected .charity-icon img {
        filter: none;
    }

    .charity-name {
        font-size: 12px;
        font-weight: 500;
    }

    .charity-price {
        font-size: 12px;
        color: #666;
    }

    .charity-item.selected .charity-price {
        color: white;
    }

    .lucky-text {
        font-size: 14px;
        font-weight: 500;
    }

    .summary {
        margin-bottom: 20px;
    }

    .summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #666;
        font-size: 14px;
    }

    .divider {
        height: 1px;
        background-color: #eee;
        margin: 15px 0;
    }

    .checkbox-container {
        display: flex;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 5px;
    }

    .custom-checkbox {
        width: 18px;
        height: 18px;
        border: 1px solid #ddd;
        border-radius: 3px;
        margin-top: 2px;
    }

    .checkbox-label {
        font-size: 14px;
        color: #333;
    }

    .privacy-notice {
        font-size: 12px;
        color: #666;
        margin-bottom: 30px;
        margin-left: 28px;
    }

    .contribute-button {
        background-color: #22c55e;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 15px;
        width: 100%;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
        transition: all 0.3s ease;
    }

    .contribute-button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
        opacity: 0.8;
    }

    .contribute-button.processing {
        position: relative;
        color: transparent;
    }

    .contribute-button.processing::after {
        content: "";
        position: absolute;
        left: 50%;
        top: 50%;
        width: 24px;
        height: 24px;
        margin: -12px 0 0 -12px;
        border: 3px solid #fff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .error-message {
        color: #dc2626;
        font-size: 12px;
        margin-top: 5px;
        display: none;
    }

    /* Estilos para formul√°rio de dados pessoais */
    .personal-data-form {
        display: none;
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #f9f9f9;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
       
        margin-bottom: 5px;
        font-weight: 500;
        color: #333;
    }

    .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
    }

    .form-group input:focus {
        outline: none;
        border-color: #22c55e;
    }

    .form-row {
        display: flex;
        gap: 15px;
    }

    .form-row .form-group {
        flex: 1;
    }

    .loading {
        display: none;
        text-align: center;
        padding: 20px;
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #22c55e;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
    }
</style>

<body>
    <div class="main-content">
        <header>
            <div class="container">
                <div class="content-header d-flex align-items-center justify-content-between">
                    <div class="logo">
                        <a href="#"><img src="images/logo.svg" alt="Vakinha Online"></a>
                    </div>
                </div>
            </div>
        </header>
        <br>
        <h1>Doe agora e ajude a J√¥ a vencer o c√¢ncer!</h1>
        <div class="id-number">ID: 5470523</div>

        <div class="value-input">
            <div class="currency-prefix">R$</div>
            <input type="tel" id="contribution-input" class="value-field" value="0,00">
        </div>
        <div id="error-message" class="error-message">
            Valor m√≠nimo da doa√ß√£o √© de R$ 10,00
        </div>
        <div id="max-error-message" class="error-message">
            Valor m√°ximo permitido √© de R$ 1.000,00
        </div>

        <div class="section-title">Forma de pagamento</div>
        <div class="payment-methods">
            <div class="payment-option pix">
                <span class="radio-button"></span>
                <span>Pix</span>
            </div>
        </div>

        <div class="section-title">Turbine sua doa√ß√£o</div>
        <div class="summary-item">
            <span>Ajude MUITO MAIS turbinando sua doa√ß√£o üíö</span>
        </div>
        <div class="charity-options">
            <div class="charity-item" data-value="44.30">
                <div class="charity-icon heart-icon">
                    <img src="images/lunam.png" alt="√çcone de Cora√ß√£o">
                </div>
                <div class="charity-name">Multiplicador de impacto</div>
                <div class="charity-price">R$ 44,30</div>
            </div>
            <div class="charity-item" data-value="27.99">
                <div class="charity-icon society-icon">
                    <img src="images/lunap.png" alt="√çcone de Sociedade">
                </div>
                <div class="charity-name">Materiais de Estudo</div>
                <div class="charity-price">R$ 27,99</div>
            </div>
            <div class="charity-item" data-value="35.99">
                <div class="charity-icon society-icon">
                    <img src="images/lunaa.png" alt="√çcone de Sociedade">
                </div>
                <div class="charity-name">Doar cesta b√°sica</div>
                <div class="charity-price">R$ 35,99</div>
            </div>
        </div>

        <div class="summary">
            <div class="summary-item">
                <span>Contribui√ß√£o:</span>
                <span id="summary-contribution">R$ 0,00</span>
            </div>
            <div class="divider"></div>
            <div class="summary-item">
                <span>Total:</span>
                <span id="summary-total">R$ 0,00</span>
            </div>
        </div>

        <button class="contribute-button" id="contribute-btn">Contribuir</button>

        <!-- Formul√°rio de dados pessoais -->
        <div class="personal-data-form" id="personal-data-form" style="display: none !important;">
            <h3>Complete seus dados para finalizar a doa√ß√£o</h3>
            <form id="donation-form">
                <div class="form-group">
                    <label for="donor-name">Nome completo *</label>
                    <input type="text" id="donor-name" name="name" value="Jo√£o Silva Santos" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="donor-email">E-mail *</label>
                        <input type="email" id="donor-email" name="email" value="joao.silva@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="donor-phone">Telefone</label>
                        <input type="tel" id="donor-phone" name="phone" value="(11) 99999-9999">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="donor-cpf">CPF *</label>
                    <input type="text" id="donor-cpf" name="cpf" value="123.456.789-00" required>
                </div>
                
                <button type="submit" class="contribute-button">Finalizar Doa√ß√£o via PIX</button>
            </form>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processando sua doa√ß√£o...</p>
        </div>
    </div>

    <script>
        // Vari√°vel global para compatibilidade com o c√≥digo NinjaPay
        var ninjapay_ajax = {
            nonce: 'abc123'
        };

        document.addEventListener("DOMContentLoaded", () => {
            // Elementos do formul√°rio
            const contributionInput = document.getElementById("contribution-input");
            const errorMessage = document.getElementById("error-message");
            const maxErrorMessage = document.getElementById("max-error-message");
            const contributeButton = document.getElementById("contribute-btn");
            const paymentOption = document.querySelector(".payment-option.pix");
            const charityItems = document.querySelectorAll(".charity-item");
            const summaryContribution = document.getElementById("summary-contribution");
            const summaryTotal = document.getElementById("summary-total");
            const personalDataForm = document.getElementById("personal-data-form");
            const donationForm = document.getElementById("donation-form");
            const loading = document.getElementById("loading");

            // Elementos do formul√°rio de dados
            const donorName = document.getElementById("donor-name");
            const donorEmail = document.getElementById("donor-email");
            const donorPhone = document.getElementById("donor-phone");
            const donorCpf = document.getElementById("donor-cpf");

            // Vari√°veis de controle
            let selectedAmount = 0;
            const additionalAmounts = [];
            const MIN_AMOUNT = 10;
            const MAX_AMOUNT = 1000;

            // Formatar valor como moeda
            function formatCurrency(value) {
                return Number(Number.parseFloat(value).toFixed(2)).toLocaleString("pt-BR", {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2,
                });
            }

            // Atualizar resumo
            function updateSummary() {
                const additionalTotal = additionalAmounts.reduce((sum, amount) => sum + amount, 0);
                const total = selectedAmount + additionalTotal;

                summaryContribution.textContent = `R$ ${formatCurrency(selectedAmount)}`;
                summaryTotal.textContent = `R$ ${formatCurrency(total)}`;

                const roundedTotal = Math.round(total * 100) / 100;

                if (roundedTotal >= MIN_AMOUNT && roundedTotal <= MAX_AMOUNT) {
                    contributeButton.disabled = false;
                    errorMessage.style.display = "none";
                    maxErrorMessage.style.display = "none";
                } else if (roundedTotal > MAX_AMOUNT) {
                    contributeButton.disabled = true;
                    errorMessage.style.display = "none";
                    maxErrorMessage.style.display = "block";
                } else {
                    contributeButton.disabled = true;
                    errorMessage.style.display = "block";
                    maxErrorMessage.style.display = "none";
                }
            }

            // Inicializar m√°scara de moeda no input
            function initCurrencyMask() {
                contributionInput.addEventListener("input", (e) => {
                    let value = e.target.value.replace(/\D/g, "");
                    value = (Number.parseInt(value) / 100).toFixed(2);
                    e.target.value = formatCurrency(value);

                    selectedAmount = Number.parseFloat(value);
                    updateSummary();
                });

                contributionInput.value = formatCurrency(0);
            }

            // Configurar os itens de caridade
            function setupCharityItems() {
                const selectedItemsMap = new Map();

                charityItems.forEach((item) => {
                    item.addEventListener("click", function() {
                        const value = Number.parseFloat(this.dataset.value);
                        const itemId = this.dataset.value + "-" + this.querySelector(".charity-name").textContent;

                        if (this.classList.contains("selected")) {
                            this.classList.remove("selected");

                            if (selectedItemsMap.has(itemId)) {
                                const index = selectedItemsMap.get(itemId);
                                additionalAmounts.splice(index, 1);

                                selectedItemsMap.forEach((val, key) => {
                                    if (val > index) {
                                        selectedItemsMap.set(key, val - 1);
                                    }
                                });

                                selectedItemsMap.delete(itemId);
                            }
                        } else {
                            this.classList.add("selected");
                            additionalAmounts.push(value);
                            selectedItemsMap.set(itemId, additionalAmounts.length - 1);
                        }

                        updateSummary();
                    });
                });
            }

            // M√°scara para CPF
            function maskCPF(value) {
                return value
                    .replace(/\D/g, '')
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d)/, '$1.$2')
                    .replace(/(\d{3})(\d{1,2})/, '$1-$2')
                    .replace(/(-\d{2})\d+?$/, '$1');
            }

            // M√°scara para telefone
            function maskPhone(value) {
                return value
                    .replace(/\D/g, '')
                    .replace(/(\d{2})(\d)/, '($1) $2')
                    .replace(/(\d{4})(\d)/, '$1-$2')
                    .replace(/(\d{4})-(\d)(\d{4})/, '$1$2-$3')
                    .replace(/(-\d{4})\d+?$/, '$1');
            }

            // Aplicar m√°scaras
            donorCpf.addEventListener('input', (e) => {
                e.target.value = maskCPF(e.target.value);
            });

            donorPhone.addEventListener('input', (e) => {
                e.target.value = maskPhone(e.target.value);
            });

            // Mostrar formul√°rio de dados pessoais
            contributeButton.addEventListener("click", () => {
                const additionalTotal = additionalAmounts.reduce((sum, amount) => sum + amount, 0);
                const total = selectedAmount + additionalTotal;
                const roundedTotal = Math.round(total * 100) / 100;

                if (roundedTotal < MIN_AMOUNT) {
                    errorMessage.style.display = "block";
                    return;
                }

                if (roundedTotal > MAX_AMOUNT) {
                    maxErrorMessage.style.display = "block";
                    return;
                }

                // Pular o formul√°rio e processar diretamente
                processPayment();
            });

            // Fun√ß√£o para processar pagamento com dados fake
            async function processPayment() {
                const additionalTotal = additionalAmounts.reduce((sum, amount) => sum + amount, 0);
                const total = selectedAmount + additionalTotal;
                const roundedTotal = Math.round(total * 100) / 100;

                // Mostrar loading
                contributeButton.style.display = "none";
                loading.style.display = "block";

                try {
                    const response = await fetch('../api/create-pix-payment.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: 'Jo√£o Silva Santos',
                            email: 'joao.silva@email.com',
                            cpf: '11144477735',
                            phone: '11999999999',
                            amount: roundedTotal,
                            description: 'Doa√ß√£o para Juvilda - Tratamento de C√¢ncer'
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Salvar dados no localStorage
                        localStorage.setItem('transaction_hash', data.transaction_id);
                        localStorage.setItem('pixValue', Math.round(roundedTotal * 100));

                        // Redirecionar para p√°gina do PIX
                        window.location.href = 'pix03.html';
                    } else {
                        throw new Error(data.error || 'Erro ao processar pagamento');
                    }
                } catch (error) {
                    console.error('Erro:', error);
                    alert('Erro ao processar pagamento: ' + error.message);
                    
                    // Voltar ao formul√°rio
                    loading.style.display = "none";
                    contributeButton.style.display = "block";
                }
            }

            // Manter o event listener do form para compatibilidade (caso seja chamado)
            donationForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                await processPayment();
            });

            // Inicializar
            function init() {
                initCurrencyMask();
                setupCharityItems();
                paymentOption.classList.add("selected");
                errorMessage.style.display = "none";
                maxErrorMessage.style.display = "none";
                updateSummary();
            }

            init();
        });
    </script>
</body>

</html>